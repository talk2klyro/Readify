<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Readify - Book Details</title>
  <style>
    :root {
      --bg-color: #f9f9f9;
      --text-color: #333;
      --card-bg: #fff;
      --card-border: #ccc;
    }
    body { background-color: var(--bg-color); color: var(--text-color); font-family: Arial, sans-serif; margin: 20px; }
    body.dark-mode { --bg-color: #121212; --text-color: #e0e0e0; --card-bg: #1e1e1e; --card-border: #333; }
    h1, h2 { text-align: center; }
    .book-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 40px; }
    .book-cover { flex: 1 1 300px; max-width: 300px; }
    .book-cover img { width: 100%; border-radius: 8px; }
    .book-details { flex: 2 1 400px; }
    .book-details p { margin: 10px 0; }
    .related-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 20px; }
    .ebook-card { border: 1px solid var(--card-border); padding: 10px; border-radius: 8px; background-color: var(--card-bg); text-align: center; transition: transform 0.2s; }
    .ebook-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .ebook-card img { max-width: 100%; border-radius: 5px; }
    #darkModeToggle { padding: 8px; margin-bottom: 20px; cursor: pointer; }
  </style>
</head>
<body>

  <button id="darkModeToggle">üåô Dark Mode</button>

  <div id="book-container" class="book-container">
    <div class="book-cover" id="book-cover"></div>
    <div class="book-details" id="book-details"></div>
  </div>

  <h2>Related Books</h2>
  <div id="related-books" class="related-list"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const bookId = params.get('id');

    let ebooks = [];

    async function loadEbooks() {
      const response = await fetch('/data/ebooks.json');
      ebooks = await response.json();
      displayBook();
      displayRelatedBooks();
    }

    function displayBook() {
      const book = ebooks.find(b => b.id === bookId);
      if (!book) { document.getElementById('book-container').innerHTML = '<p>Book not found.</p>'; return; }

      document.getElementById('book-cover').innerHTML = `<img src="${book.cover}" alt="${book.title}" loading="lazy">`;
      document.getElementById('book-details').innerHTML = `
        <h1>${book.title}</h1>
        <p><strong>Author:</strong> ${book.author}</p>
        <p><strong>Category:</strong> ${book.category}</p>
        <p>${book.description}</p>
      `;
    }

    function displayRelatedBooks() {
      const book = ebooks.find(b => b.id === bookId);
      if(!book) return;
      const related = ebooks.filter(b => b.category === book.category && b.id !== book.id).slice(0,5);
      const container = document.getElementById('related-books');
      related.forEach(b => {
        const card = document.createElement('div');
        card.className = 'ebook-card';
        card.innerHTML = `
          <a href="${b.url}">
            <img src="${b.cover}" alt="${b.title}" loading="lazy">
            <p>${b.title}</p>
            <p><em>${b.author}</em></p>
          </a>
        `;
        container.appendChild(card);
      });
    }

    // Dark Mode
    const darkModeToggle = document.getElementById('darkModeToggle');
    darkModeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('readify-theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
      darkModeToggle.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
    });

    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('readify-theme');
      if(savedTheme==='dark'){ document.body.classList.add('dark-mode'); darkModeToggle.textContent='‚òÄÔ∏è Light Mode'; }
    });

    loadEbooks();
  </script>
</body>
</html>

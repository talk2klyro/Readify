// js/main.js

// Load products.json
async function loadProducts() {
  const res = await fetch("products.json");
  return await res.json();
}

// ====== CATALOG PAGE ======
async function renderCatalog() {
  const container = document.querySelector(".catalog");
  if (!container) return;

  const products = await loadProducts();
  container.innerHTML = "";

  products.forEach(p => {
    const card = document.createElement("div");
    card.className = "book-card";

    card.innerHTML = `
      <img src="${p.cover}" alt="${p.title}">
      <h3>${p.title}</h3>
      <p class="author">${p.author}</p>
      <p class="price">₦${p.price.toLocaleString()}</p>
      <button onclick="window.location.href='product.html?id=${p.id}'">
        View Details
      </button>
    `;

    container.appendChild(card);
  });
}

// ====== PRODUCT PAGE ======
async function renderProduct() {
  const container = document.querySelector(".product-container");
  if (!container) return;

  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  if (!id) {
    container.innerHTML = "<p>Product not found.</p>";
    return;
  }

  const products = await loadProducts();
  const product = products.find(p => p.id === id);

  if (!product) {
    container.innerHTML = "<p>Product not found.</p>";
    return;
  }

  // Render product detail
  container.innerHTML = `
    <div class="product-image">
      <img src="${product.cover}" alt="${product.title}">
    </div>
    <div class="product-info">
      <h2>${product.title}</h2>
      <p class="author">${product.author}</p>
      <p class="price">₦${product.price.toLocaleString()} ${product.currency}</p>
      <p><strong>Format:</strong> ${product.format}</p>
      <p><strong>Bonus:</strong> ${product.bonus}</p>
      <a href="#" class="btn-buy">Buy Now</a>
      <a href="${product.sampleBlob}" target="_blank" class="btn-outline">Read Sample</a>
    </div>
  `;

  // Render description + highlights
  const desc = document.createElement("div");
  desc.className = "product-description";

  desc.innerHTML = `
    <h3>About this eBook</h3>
    <p>${product.description}</p>
    <h3>Highlights</h3>
    <ul>
      ${product.highlights.map(h => `<li>${h}</li>`).join("")}
    </ul>
  `;

  container.parentNode.appendChild(desc);

  // TODO: Hook up Flutterwave checkout to .btn-buy
}

// ====== INIT ======
document.addEventListener("DOMContentLoaded", () => {
  renderCatalog();
  renderProduct();
});
